name: Rajawi Weather Factory ğŸ­

on:
  schedule:
    - cron: '0 */6 * * *' # ÙŠØ¹Ù…Ù„ ÙƒÙ„ 6 Ø³Ø§Ø¹Ø§Øª
  workflow_dispatch: # ÙŠØ³Ù…Ø­ Ø¨Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ÙŠØ¯ÙˆÙŠ

jobs:
  build:
    runs-on: ubuntu-latest

    permissions:
      contents: write # ØµÙ„Ø§Ø­ÙŠØ§Øª Ø§Ù„ÙƒØªØ§Ø¨Ø© Ø¶Ø±ÙˆØ±ÙŠØ©

    steps:
    - name: Checkout code
      uses: actions/checkout@v3
      with:
        fetch-depth: 0 # Ø¬Ù„Ø¨ ØªØ§Ø±ÙŠØ® Ø§Ù„ØªØºÙŠÙŠØ±Ø§Øª ÙƒØ§Ù…Ù„Ø§Ù‹ Ù„ØªØ¬Ù†Ø¨ Ø§Ù„Ø£Ø®Ø·Ø§Ø¡

    - name: Setup Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: Install Dependencies
      run: npm install

    - name: Run The Factory (Harvest Data) ğŸšœ
      run: node index.js

    - name: Commit and Push Data ğŸš€
      run: |
        # 1. ØªØ¹Ø±ÙŠÙ Ù‡ÙˆÙŠØ© Ø§Ù„Ø±ÙˆØ¨ÙˆØª
        git config --global user.name 'Rajawi Bot'
        git config --global user.email 'bot@rajawi.weather'
        
        # 2. ØªØ¬Ù‡ÙŠØ² Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¬Ø¯ÙŠØ¯
        git add weather_output.json
        
        # 3. Ø­ÙØ¸ Ø§Ù„ØªØºÙŠÙŠØ± Ù…Ø¤Ù‚ØªØ§Ù‹ ÙÙŠ Ø¬Ù‡Ø§Ø² Ø§Ù„Ø±ÙˆØ¨ÙˆØª
        # (|| exit 0) ØªØ¹Ù†ÙŠ: Ù„Ùˆ Ù„Ù… ÙŠÙˆØ¬Ø¯ ØªØºÙŠÙŠØ±ØŒ ØªÙˆÙ‚Ù Ø¨Ù†Ø¬Ø§Ø­ ÙˆÙ„Ø§ ØªØ¹ØªØ¨Ø±Ù‡ Ø®Ø·Ø£
        git commit -m "ğŸŒªï¸ Update Wind Data: $(date)" || exit 0
        
        # 4. Ø§Ù„Ø®Ø·ÙˆØ© Ø§Ù„Ø­Ø§Ø³Ù…Ø©: Ø³Ø­Ø¨ Ø£ÙŠ ØªØºÙŠÙŠØ±Ø§Øª Ù‚Ù…Øª Ø¨Ù‡Ø§ Ø£Ù†Øª ÙˆØ¯Ù…Ø¬Ù‡Ø§ (Rebase)
        # Ù‡Ø°Ø§ ÙŠØ­Ù„ Ù…Ø´ÙƒÙ„Ø© [rejected] fetch first
        git pull --rebase origin main
        
        # 5. Ø§Ù„Ø±ÙØ¹ Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ
        git push origin main
