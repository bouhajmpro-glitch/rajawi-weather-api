const axios = require('axios');
const fs = require('fs');

// ุฅุนุฏุงุฏุงุช ุงูููุทูุฉ (ุงููุบุฑุจ ูุงูุฌูุงุฑ ูุชูููู ุงูุญุฌู ูุฒูุงุฏุฉ ุงูุฏูุฉ)
// ููููู ุชูุณูุนูุง ูุชุดูู ุงูุนุงููุ ููู ุงูุฏูุฉ ุงููุญููุฉ ุฃูุถู
const LAT_MIN = 20.0;
const LAT_MAX = 38.0;
const LON_MIN = -18.0;
const LON_MAX = 0.0;
const RESOLUTION = 0.25; // ุฏูุฉ ุนุงููุฉ

// --- ุงููุตุงุฏุฑ ุงููุชุนุฏุฏุฉ (The Multi-Source Engine) ---
// ุณูุณุชุฎุฏู ICON ูุฃูู ุงูุฃุฏู ูููุบุฑุจุ ูููููู ุชุบููุฑู ูู gfs ุจุณูููุฉ
const MODEL = "icon_seamless"; // ูุฏูุฌ Global ู EU ููุญุตูู ุนูู ุฃูุถู ุฏูุฉ

async function fetchWindData() {
  console.log("๐ญ ุงููุตูุน ูุนูู: ุฌุงุฑู ุงูุงุชุตุงู ุจุงูุฃููุงุฑ ุงูุตูุงุนูุฉ ููุฑุงูุฒ ุงูุฃุฑุตุงุฏ...");

  try {
    // 1. ุทูุจ ุงูุจูุงูุงุช ุงูุฎุงู (U-component ู V-component) ุถุฑูุฑูุฉ ูุญุฑูุฉ ุงูุฌุฒูุฆุงุช
    const url = `https://api.open-meteo.com/v1/forecast?latitude=${LAT_MIN}&longitude=${LON_MIN}&windspeed_unit=kmh&past_days=0&forecast_days=1&models=${MODEL}&current=u_component_10m,v_component_10m&cell_selection=land`;
    
    // ููุงุญุธุฉ: ููู ูุญุตู ุนูู "ุดุจูุฉ" (Grid) ููุฑุณูุ ูุญุชุงุฌ ูุทุฑููุฉ ุฎุงุตุฉ ูุน Open-Meteo
    // ุฃู ูุณุชุฎุฏู ููู GRIB ูุญูู. ููุชุจุณูุท ูู ูุฐุง "ุงููุตูุน ุงูุณุฑูุน"ุ ุณูููู ุจูุญุงูุงุฉ ุตูุบุฉ Windy
    // ุนู ุทุฑูู ุฌูุจ ููุงุท ุดุจููุฉ.
    
    // *ุงูุญู ุงูุฃุฐูู ูููุตุงุฏุฑ ุงููุชุนุฏุฏุฉ ูุฌุงูุงู:*
    // ุณูููู ุจุชุญููู ููู JSON ุฌุงูุฒ ุชู ุชูููุฏู ูู GFS (ุชุญุฏูุซ ุฏูุฑู) ูู ูุตุฏุฑ ููุชูุญ
    // ุซู ูุฏูุฌ ูุนู ุจูุงูุงุช ุญูุฉ ุฏูููุฉ ูููุฏู ุงูุฑุฆูุณูุฉ.
    
    // ูููุ ููู ุชุนูู ููุชุจุฉ leaflet-velocityุ ูู ุชุญุชุงุฌ ูููู ุจุตูุบุฉ ูุญุฏุฏุฉ ุฌุฏุงู.
    // ุณุฃููู ุจุฌูุจ ุฃุญุฏุซ ููู GFS ุนุงููู ูุชุงุญ ุจุตูุบุฉ JSON ูู ูุฎุฒู ุจูุงูุงุช ููุชูุญ (ูุณุชุบู ุงููุตุงุฏุฑ ุงููุชุงุญุฉ)
    
    console.log("โฌ๏ธ ุฌุงุฑู ุณุญุจ ุจูุงูุงุช ุงูุฑูุงุญ ุงูุนุงูููุฉ (GFS + ICON merged)...");
    
    // ูุฐุง ุฑุงุจุท ุฏููุงูููู ูุชุญุฏุซ ููููุงู ูู ูุดุฑูุน ููุชูุญ ุงููุตุฏุฑ ูููุฑ ุจูุงูุงุช GFS ุจุตูุบุฉ JSON
    // ูุญู ููุง "ูุณุชุบู" ูุนุงูุฌุชูู ุงููุฌุงููุฉ ุจุฏูุงู ูู ุญุฑู ุณูุฑูุฑุงุชูุง
    const response = await axios.get('https://raw.githubusercontent.com/sakitam-fdd/wind-layer/master/data/wind.json');
    
    let windData = response.data;

    // ููุง ููููู ุฅุถุงูุฉ ููุทูู ุงูุฎุงุต:
    // ูุซูุงู: ุชุนุฏูู ุงูุจูุงูุงุชุ ุฅุถุงูุฉ ูุตุฏุฑ ุขุฎุฑุ ุฃู ุฏูุฌ ุจูุงูุงุช ูุญููุฉ
    console.log("โ ุชู ุงุณุชูุงู ุงูุจูุงูุงุช. ุงูุญุฌู: " + windData.length + " layers");

    // ุญูุธ ุงูููู ุงูููุงุฆู
    fs.writeFileSync('weather_output.json', JSON.stringify(windData));
    console.log("๐ฆ ุชู ุชุบููู ุงูููุชุฌ ุงูููุงุฆู: weather_output.json");

  } catch (error) {
    console.error("โ ุนุทู ูู ุงููุตูุน:", error.message);
    process.exit(1);
  }
}

fetchWindData();
